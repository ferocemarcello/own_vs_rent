<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy vs. Rent Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Ensure inputs are visible in dark mode */
        input[type="number"] {
            @apply text-white;
        }
    </style>
    <script>
        // Set up Tailwind dark mode
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-200 font-sans antialiased p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-center text-white mb-8">Buy vs. Rent Calculator</h1>

        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8 max-w-2xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="analysis-period" class="block text-lg font-semibold text-white">Analysis Period (Years)</label>
                <input type="number" id="analysis-period" value="10" class="w-full mt-2 bg-gray-700 border border-gray-600 rounded-md p-3 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <label for="inflation" class="block text-lg font-semibold text-white">Yearly Inflation (%)</label>
                <input type="number" id="inflation" value="2.0" class="w-full mt-2 bg-gray-700 border border-gray-600 rounded-md p-3 focus:ring-blue-500 focus:border-blue-500">
            </div>
        </div>

        <div>
            <div id="international-version">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg space-y-4">
                        <h2 class="text-2xl font-semibold text-white border-b border-gray-700 pb-3">Purchase Inputs</h2>
                        
                        <div>
                            <label for="int-home-price" class="block text-sm font-medium text-gray-300">Home Initial Price</label>
                            <input type="number" id="int-home-price" value="500000" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-initial-costs-pct" class="block text-sm font-medium text-gray-300">Initial Costs (% of Home Price)</label>
                            <input type="number" id="int-initial-costs-pct" value="5" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>
                        
                        <div>
                            <label for="int-initial-costs-abs" class="block text-sm font-medium text-gray-300">Initial Costs (Absolute)</label>
                            <input type="number" id="int-initial-costs-abs" value="2000" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-fixed-term-abs" class="block text-sm font-medium text-gray-300">Annual Expenses with Fixed Term (Absolute)(e.g. mortgage)</label>
                            <input type="number" id="int-fixed-term-abs" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-fixed-term-years" class="block text-sm font-medium text-gray-300">Years for Fixed Term Expenses</label>
                            <input type="number" id="int-fixed-term-years" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-purchase-annual-investment-during" class="block text-sm font-medium text-gray-300">Annual Investment during fixed term expenses</label>
                            <input type="number" id="int-purchase-annual-investment-during" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-other-annual-abs" class="block text-sm font-medium text-gray-300">Additional Annual Expenses (Absolute)</label>
                            <input type="number" id="int-other-annual-abs" value="1500" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-other-annual-pct" class="block text-sm font-medium text-gray-300">Other Annual Expenses (% of Home Value)</label>
                            <input type="number" id="int-other-annual-pct" value="1.0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-home-appreciation" class="block text-sm font-medium text-gray-300">Home Yearly Appreciation (%)</label>
                            <input type="number" id="int-home-appreciation" value="3.0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>
                        
                        <div>
                            <label for="int-end-term-pct" class="block text-sm font-medium text-gray-300">Expenses at End of Term (% of Price)</label>
                            <input type="number" id="int-end-term-pct" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-end-term-abs" class="block text-sm font-medium text-gray-300">Expenses at End of Term (Absolute)</label>
                            <input type="number" id="int-end-term-abs" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>
                        
                        <div>
                            <label for="int-selling-costs-pct" class="block text-sm font-medium text-gray-300">Selling Costs (% of Final Price)</label>
                            <input type="number" id="int-selling-costs-pct" value="5.0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>
                        
                        <div>
                            <label for="int-purchase-annual-investment-after" class="block text-sm font-medium text-gray-300">Annual Investment after fixed term expenses</label>
                            <input type="number" id="int-purchase-annual-investment-after" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>
                    </div>

                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg space-y-4">
                        <h2 class="text-2xl font-semibold text-white border-b border-gray-700 pb-3">Rental Inputs</h2>
                        
                        <div>
                            <label for="int-annual-rent" class="block text-sm font-medium text-gray-300">Annual Rent (Absolute)</Tabel>
                            <input type="number" id="int-annual-rent" value="20000" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-rent-increase" class="block text-sm font-medium text-gray-300">Rent Increase (%/year)</label>
                            <input type="number" id="int-rent-increase" value="2.0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-rent-additional-annual-abs" class="block text-sm font-medium text-gray-300">Additional Annual Expenses (Absolute)</label>
                            <input type="number" id="int-rent-additional-annual-abs" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-rental-annual-investment" class="block text-sm font-medium text-gray-300">Annual Investment</label>
                            <input type="number" id="int-rental-annual-investment" value="0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>
                    </div>

                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg space-y-4">
                        <h2 class="text-2xl font-semibold text-white border-b border-gray-700 pb-3">Investment Inputs</h2>
                        
                        <div>
                            <label for="int-initial-deposit" class="block text-sm font-medium text-gray-300">Initial Deposit (for Renter)</label>
                            <input type="number" id="int-initial-deposit" value="77000" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-investment-return" class="block text-sm font-medium text-gray-300">Investment Return (%/year)</label>
                            <input type="number" id="int-investment-return" value="6.0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>

                        <div>
                            <label for="int-cap-gains-tax" class="block text-sm font-medium text-gray-300">Capital Gains Tax (%)</label>
                            <input type="number" id="int-cap-gains-tax" value="15.0" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md p-2">
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="text-center mt-8">
            <button id="calculate-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 shadow-lg">
                Calculate
            </button>
        </div>

        <div id="results-section" class="mt-10 bg-gray-800 p-6 rounded-xl shadow-lg hidden">
            <h2 class="text-2xl font-semibold text-white mb-6 text-center">Results after <span id="results-years">10</span> Years</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center mb-8">
                <div>
                    <div class="text-sm text-gray-400">Owner's Net Worth</div>
                    <div id="owner-net-worth" class="text-3xl font-bold text-cyan-400"></div>
                </div>
                <div>
                    <div class="text-sm text-gray-400">Renter's Net Worth</div>
                    <div id="renter-net-worth" class="text-3xl font-bold text-lime-400"></div>
                </div>
                <div>
                    <div class="text-sm text-gray-400">Net Benefit of <span id="winner"></span></div>
                    <div id="net-benefit" class="text-3xl font-bold text-white"></div>
                </div>
            </div>

            <div>
                <canvas id="comparison-chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const calculateBtn = document.getElementById('calculate-btn');
        const resultsSection = document.getElementById('results-section');
        const chartCanvas = document.getElementById('comparison-chart');
        
        const resultsYears = document.getElementById('results-years');
        const ownerNetWorthEl = document.getElementById('owner-net-worth');
        const renterNetWorthEl = document.getElementById('renter-net-worth');
        const winnerEl = document.getElementById('winner');
        const netBenefitEl = document.getElementById('net-benefit');

        let myChart; // To hold the chart instance

        // --- Event Listeners ---

        // Calculate Button Logic
        calculateBtn.addEventListener('click', () => {
            const years = getVal('analysis-period');
            const results = calculateInternational(years);

            if (results) {
                displayResults(results, years);
            }
        });

        // --- Helper Functions ---

        /**
         * Gets the numerical value from an input field.
         * @param {string} id - The ID of the input element.
         * @returns {number} - The parsed float value, or 0 if empty/invalid.
         */
        function getVal(id) {
            const el = document.getElementById(id);
            if (!el) {
                // This will log an error if an ID is wrong, but allows execution to continue
                console.error('Element not found:', id); 
                return 0;
            }
            return parseFloat(el.value) || 0;
        }

        /**
         * Formats a number as currency (using generic style for int'l)
         * @param {number} value - The number to format.
         * @returns {string} - Formatted currency string.
         */
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'decimal',
                maximumFractionDigits: 0,
            }).format(value);
        }

        // --- Calculation Logic ---

        /**
         * Runs the simulation for the International Market (simplified cash purchase model).
         * @param {number} years - The analysis period.
         * @returns {object} - An object containing final values and history arrays.
         */
        function calculateInternational(years) {
            // --- Get Purchase Inputs ---
            const homePrice = getVal('int-home-price');
            const initialCostsPct = getVal('int-initial-costs-pct') / 100;
            const initialCostsAbs = getVal('int-initial-costs-abs');
            const fixedTermAbs = getVal('int-fixed-term-abs');
            const fixedTermYears = getVal('int-fixed-term-years');
            const otherAnnualAbs = getVal('int-other-annual-abs'); // This is the owner's additional annual
            const otherAnnualPct = getVal('int-other-annual-pct') / 100;
            const appreciation = getVal('int-home-appreciation') / 100;
            
            // NEW/RENAMED INVESTMENT INPUTS
            const purchaseAnnualInvestmentDuring = getVal('int-purchase-annual-investment-during');
            const purchaseAnnualInvestmentAfter = getVal('int-purchase-annual-investment-after');

            const endTermPct = getVal('int-end-term-pct') / 100;
            const endTermAbs = getVal('int-end-term-abs');
            const sellingCostsPct = getVal('int-selling-costs-pct') / 100;
            
            // --- Get Rental Inputs ---
            let currentRent = getVal('int-annual-rent');
            const rentIncrease = getVal('int-rent-increase') / 100;
            const rentAdditionalAnnualAbs = getVal('int-rent-additional-annual-abs'); // Get renter's additional annual
            const rentalAnnualInvestment = getVal('int-rental-annual-investment');

            // --- Get Global/Investment Inputs ---
            const inflation = getVal('inflation') / 100; // Get inflation from top control
            const initialDeposit = getVal('int-initial-deposit');
            const investmentRate = getVal('int-investment-return') / 100;
            const capGainsTax = getVal('int-cap-gains-tax') / 100;

            // --- Initial Calculations ---
            
            // 1. Owner's Initial State
            const initialClosingCosts = (homePrice * initialCostsPct) + initialCostsAbs;
            // The initialOwnerCashOutlay is the capital the renter invests at T=0
            // Assuming the renter starts with the initial deposit and the owner's costs are sunk.
            // For simplicity in this model, let's assume all initial owner costs are sunk, and the renter's initial investment is from the deposit.

            let ownerInvestmentPortfolio = 0; // Owner has a separate portfolio
            let ownerPortfolioBasis = 0; // To track contributions for cap gains

            // 2. Renter's Initial State
            let renterInvestment = initialDeposit; // Renter starts with the initial deposit
            let renterPortfolioBasis = initialDeposit; // To track contributions for cap gains

            // --- Simulation Setup (Inflation Tracking) ---
            let currentHomeValue = homePrice;
            let currentOtherAnnualAbs = otherAnnualAbs; 
            let currentRentAdditionalAnnualAbs = rentAdditionalAnnualAbs; 
            
            // Initialize inflating tracking variables for Owner's annual investment
            let currentPurchaseAnnualInvestmentDuring = purchaseAnnualInvestmentDuring;
            let currentPurchaseAnnualInvestmentAfter = purchaseAnnualInvestmentAfter;
            let currentRentalAnnualInvestment = rentalAnnualInvestment; // Only needs to be inflated

            // --- Simulation ---
            let ownerNetWorthHistory = [];
            let renterNetWorthHistory = [];
            
            // Year 0
            // NOTE: The Owner's initial cash outlay (Home Price + Initial Costs) is not reflected in net worth unless equity or loan is tracked. 
            // In this cash-purchase model, we track Home Value + Investment Portfolio.
            ownerNetWorthHistory.push(currentHomeValue + ownerInvestmentPortfolio); 
            renterNetWorthHistory.push(renterInvestment);

            for (let year = 1; year <= years; year++) {
                // --- Owner Simulation ---
                const annualFixed = (year <= fixedTermYears) ? fixedTermAbs : 0;
                const annualOther = currentOtherAnnualAbs + (currentHomeValue * otherAnnualPct);
                const totalOwnerCosts = annualFixed + annualOther;
                
                // Determine the owner's annual investment based on fixed term
                const annualOwnerInvestment = (year <= fixedTermYears)
                    ? currentPurchaseAnnualInvestmentDuring
                    : currentPurchaseAnnualInvestmentAfter;

                // Owner's separate investment
                ownerInvestmentPortfolio += annualOwnerInvestment;
                ownerPortfolioBasis += annualOwnerInvestment; // Add contribution to basis
                ownerInvestmentPortfolio *= (1 + investmentRate); // Grow portfolio
                
                // Update values for *next* year
                currentHomeValue *= (1 + appreciation);
                currentOtherAnnualAbs *= (1 + inflation);
                
                // Inflate both investment amounts for next year, regardless of which was used this year
                currentPurchaseAnnualInvestmentDuring *= (1 + inflation);
                currentPurchaseAnnualInvestmentAfter *= (1 + inflation);


                // --- Renter Simulation ---
                const renterCost = currentRent + currentRentAdditionalAnnualAbs;
                
                // Renter invests the difference AND their own annual investment
                const annualSavings = totalOwnerCosts - renterCost;
                
                // Renter's savings are invested
                renterInvestment += annualSavings;
                renterPortfolioBasis += annualSavings;
                
                // Renter's annual investment is added
                renterInvestment += currentRentalAnnualInvestment;
                renterPortfolioBasis += currentRentalAnnualInvestment;
                
                renterInvestment *= (1 + investmentRate); // Grow portfolio

                // Update values for *next* year
                currentRent *= (1 + rentIncrease);
                currentRentAdditionalAnnualAbs *= (1 + inflation);
                currentRentalAnnualInvestment *= (1 + inflation);
                
                // --- Store History ---
                const currentOwnerNetWorth = currentHomeValue + ownerInvestmentPortfolio;
                ownerNetWorthHistory.push(currentOwnerNetWorth);
                renterNetWorthHistory.push(renterInvestment);
            }

            // --- Final Calculations (End of Period) ---
            
            // 1. Owner sells
            const sellingCosts = currentHomeValue * sellingCostsPct;
            const endTermCosts = (currentHomeValue * endTermPct) + endTermAbs;
            
            // Final Home Value (after costs and taxes)
            let finalHomeValue = currentHomeValue - sellingCosts - endTermCosts;
            const homeGains = finalHomeValue - homePrice; // Simplified gain calculation
            if (homeGains > 0) {
                finalHomeValue -= (homeGains * capGainsTax);
            }

            // Final Portfolio Value (after taxes)
            let finalOwnerPortfolio = ownerInvestmentPortfolio;
            const ownerPortfolioGains = finalOwnerPortfolio - ownerPortfolioBasis;
            if (ownerPortfolioGains > 0) {
                finalOwnerPortfolio -= (ownerPortfolioGains * capGainsTax);
            }
            
            const finalOwnerNetWorth = finalHomeValue + finalOwnerPortfolio;

            // 2. Renter cashes out
            let finalRenterNetWorth = renterInvestment;
            const renterGains = finalRenterNetWorth - renterPortfolioBasis;
            if (renterGains > 0) {
                finalRenterNetWorth -= (renterGains * capGainsTax);
            }
            
            return {
                owner: finalOwnerNetWorth,
                renter: finalRenterNetWorth,
                ownerHistory: ownerNetWorthHistory,
                renterHistory: renterNetWorthHistory,
            };
        }
        
        // --- Display Functions ---

        /**
         * Renders the results and the chart.
         * @param {object} results - The results object from the calculation.
         * @param {number} years - The analysis period.
         */
        function displayResults(results, years) {
            resultsYears.textContent = years;
            
            const { owner, renter, ownerHistory, renterHistory } = results;

            ownerNetWorthEl.textContent = formatCurrency(owner);
            renterNetWorthEl.textContent = formatCurrency(renter);
            
            const benefit = Math.abs(owner - renter);
            if (owner > renter) {
                winnerEl.textContent = "Owning";
                netBenefitEl.textContent = formatCurrency(benefit);
                netBenefitEl.classList.add('text-cyan-400');
                netBenefitEl.classList.remove('text-lime-400', 'text-white');
            } else {
                winnerEl.textContent = "Renting";
                netBenefitEl.textContent = formatCurrency(benefit);
                netBenefitEl.classList.add('text-lime-400');
                netBenefitEl.classList.remove('text-cyan-400', 'text-white');
            }

            renderChart(ownerHistory, renterHistory, years);
            resultsSection.classList.remove('hidden');
        }

        /**
         * Renders the line chart using Chart.js.
         */
        function renderChart(ownerHistory, renterHistory, years) {
            const ctx = chartCanvas.getContext('2d');
            const labels = Array.from({ length: years + 1 }, (_, i) => `Year ${i}`);

            if (myChart) {
                myChart.destroy(); // Destroy previous chart instance
            }

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Owner Net Worth',
                            data: ownerHistory,
                            borderColor: 'rgb(34, 211, 238)', // cyan-400
                            backgroundColor: 'rgba(34, 211, 238, 0.1)',
                            fill: true,
                            tension: 0.1
                        },
                        {
                            label: 'Renter Net Worth',
                            data: renterHistory,
                            borderColor: 'rgb(163, 230, 53)', // lime-400
                            backgroundColor: 'rgba(163, 230, 53, 0.1)',
                            fill: true,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                color: '#d1d5db', // gray-300
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)' // White with alpha
                            }
                        },
                        x: {
                            ticks: {
                                color: '#d1d5db', // gray-300
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#d1d5db' // gray-300
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            // Set explicit height for the canvas container
            chartCanvas.parentElement.style.height = '400px';
        }

    </script>
</body>
</html>
